{{ define "main" }}
<article class="blog-post">
  {{ $coverParam := .Params.cover }}
  {{ if $coverParam }}
    {{ $coverType := printf "%T" $coverParam }}
    {{ $coverSrc := "" }}
    {{ $coverAlt := .Title }}
    {{ if eq $coverType "string" }}
      {{ $coverSrc = $coverParam }}
    {{ else if in $coverType "map" }}
      {{ $coverImage := index $coverParam "image" | default (index $coverParam "src") }}
      {{ with $coverImage }}
        {{ $coverImageType := printf "%T" . }}
        {{ if eq $coverImageType "string" }}
          {{ $coverSrc = . }}
        {{ else if in $coverImageType "map" }}
          {{ with index . "src" }}
            {{ $coverSrc = . }}
          {{ end }}
          {{ with index . "alt" }}
            {{ $coverAlt = . }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{ with index $coverParam "alt" }}
        {{ $coverAlt = . }}
      {{ end }}
      {{ if and (not $coverSrc) (isset $coverParam "image") }}
        {{ with $coverParam.image }}
          {{ $innerType := printf "%T" . }}
          {{ if eq $innerType "string" }}
            {{ $coverSrc = . }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ if $coverSrc }}
      {{ if not (hasPrefix $coverSrc "http") }}
        {{ $coverSrc = $coverSrc | relURL }}
      {{ end }}
      <div class="post-hero">
        <img src="{{ $coverSrc }}" alt="{{ $coverAlt }}">
      </div>
    {{ end }}
  {{ end }}
  <header class="post-header">
    <h1>{{ .Title }}</h1>
    <div class="post-meta">
      {{ if and (.Site.Params.blog.showDates) (.Date) }}
        <time class="post-date">{{ i18n "Published" }}: {{ .Date.Format (i18n "dateFormat") }}</time>
      {{ end }}
      {{ if and (.Site.Params.blog.showDates) (.Lastmod) }}
        <time class="post-updated">{{ i18n "LastUpdated" }}: {{ .Lastmod.Format (i18n "dateFormat") }}</time>
      {{ end }}
    </div>
    {{ with .Params.tags }}{{ if $.Site.Params.blog.showTags }}
      <div class="post-tags">
        {{ range . }}
          <span class="tag">{{ . }}</span>
        {{ end }}
      </div>
    {{ end }}{{ end }}
    {{ partial "author-info.html" . }}
  </header>
  <div class="post-content rich-content">
    {{ .Content }}
  </div>

  {{ partial "backlink-single.html" . }}

  {{ partial "share-buttons.html" . }}
</article>
{{ end }}
