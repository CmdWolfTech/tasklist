{{ define "main" }}
{{ with .Params.start }}{{ $.Scratch.Set "start" (time .) }}{{ end }}
{{ with .Params.end }}{{ $.Scratch.Set "end" (time .) }}{{ end }}
{{ $start := $.Scratch.Get "start" }}
{{ $end := $.Scratch.Get "end" }}
{{ if and $start $end }}{{ $.Scratch.Set "days" (add 1 (div (sub ($end.Unix) ($start.Unix)) 86400)) }}{{ end }}
<div class="project-single-container">
    <article class="project-content">
        <header class="project-header">
            <h1 class="project-title">{{ .Title }}</h1>
            {{ with .Description }}
            <p class="project-description">{{ . }}</p>
            {{ end }}
            <div class="project-meta">
                {{ with .Params.status }}
                <span class="status status-{{ replace (lower .) " " "-" }}">
                    {{ if eq . "completed" }}{{ i18n "taskCompleted" }}{{ else if eq . "in-progress" }}{{ i18n "taskInProgress" }}{{ else if eq . "not-started" }}{{ i18n "taskNotStarted" }}{{ else }}{{ . }}{{ end }}
                </span>
                {{ end }}
                {{ with .Params.priority }}
                <span class="priority priority-{{ lower . }}">
                    {{ if eq . "High" }}{{ i18n "priorityHigh" }}{{ else if eq . "Medium" }}{{ i18n "priorityMedium" }}{{ else if eq . "Low" }}{{ i18n "priorityLow" }}{{ else }}{{ . }}{{ end }}
                </span>
                {{ end }}
            </div>
        </header>

        <section class="project-details">
            <dl>
                {{ with $start }}
                <div>
                    <dt>{{ i18n "Start" }}</dt>
                    <dd>{{ .Format (i18n "dateFormat") }}</dd>
                </div>
                {{ end }}
                {{ with $end }}
                <div>
                    <dt>{{ i18n "End" }}</dt>
                    <dd>{{ .Format (i18n "dateFormat") }}</dd>
                </div>
                {{ end }}
                {{ with $.Scratch.Get "days" }}
                <div>
                    <dt>{{ i18n "Period" }}</dt>
                    <dd>{{ . }}{{ i18n "Days" }}</dd>
                </div>
                {{ end }}
                {{ with .Params.assignee }}
                <div>
                    <dt>{{ i18n "PIC" }}</dt>
                    <dd>{{ . }}</dd>
                </div>
                {{ end }}
                <div>
                    <dt>{{ i18n "LastUpdated" }}</dt>
                    <dd>
                        {{ with .Params.lastmod }}
                            {{ . | time.Format (i18n "dateFormat") }}
                        {{ else }}
                            {{ .Lastmod.Format (i18n "dateFormat") }}
                        {{ end }}
                    </dd>
                </div>
                {{ with .Params.tags }}
                <div class="project-tags">
                    <dt>{{ i18n "Tags" }}</dt>
                    <dd>
                        <div class="post-tags">
                            {{ range . }}
                            <span class="tag">{{ . }}</span>
                            {{ end }}
                        </div>
                    </dd>
                </div>
                {{ end }}
                {{ with .Params.parent }}
                {{ $parent := $.CurrentSection.GetPage . }}
                <div>
                    <dt>{{ i18n "ParentTask" }}</dt>
                    <dd>
                        {{ if $parent }}
                            <a href="{{ $parent.RelPermalink }}">{{ $parent.Title }}</a>
                        {{ else }}
                            {{ . }}
                        {{ end }}
                    </dd>
                </div>
                {{ end }}
            </dl>
            {{ $children := where $.CurrentSection.Pages "Params.parent" $.File.BaseFileName }}
            {{ if gt (len $children) 0 }}
            <div class="project-children">
                <h2>{{ i18n "ChildTasks" }}</h2>
                <ul>
                    {{ range $children }}
                    <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
                    {{ end }}
                </ul>
            </div>
            {{ end }}
        </section>

        <section class="project-body">
            {{ .Content }}
        </section>
    </article>
</div>
{{ partial "backlink.html" . }}
{{ partial "backlink-single.html" . }}
{{ partial "share-buttons.html" . }}

{{ end }}
