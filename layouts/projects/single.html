{{ define "main" }}
{{ with .Params.start }}{{ $.Scratch.Set "start" (time .) }}{{ end }}
{{ with .Params.end }}{{ $.Scratch.Set "end" (time .) }}{{ end }}
{{ $start := $.Scratch.Get "start" }}
{{ $end := $.Scratch.Get "end" }}
{{ if and $start $end }}{{ $.Scratch.Set "days" (add 1 (div (sub ($end.Unix) ($start.Unix)) 86400)) }}{{ end }}
<div class="project-single-container">
    <article class="project-content">
        <header class="project-header">
            <h1 class="project-title">{{ .Title }}</h1>
            {{ with .Description }}
            <p class="project-description">{{ . }}</p>
            {{ end }}
            <div class="project-meta">
                {{ with .Params.status }}
                <span class="status status-{{ replace (lower .) " " "-" }}">
                    {{ if eq . "completed" }}{{ i18n "taskCompleted" }}{{ else if eq . "in-progress" }}{{ i18n "taskInProgress" }}{{ else if eq . "not-started" }}{{ i18n "taskNotStarted" }}{{ else }}{{ . }}{{ end }}
                </span>
                {{ end }}
                {{ with .Params.priority }}
                <span class="priority priority-{{ lower . }}">
                    {{ if eq . "High" }}{{ i18n "priorityHigh" }}{{ else if eq . "Medium" }}{{ i18n "priorityMedium" }}{{ else if eq . "Low" }}{{ i18n "priorityLow" }}{{ else }}{{ . }}{{ end }}
                </span>
                {{ end }}
            </div>
        </header>

        <section class="project-details">
            <dl>
                {{ with $start }}
                <div>
                    <dt>{{ i18n "Start" }}</dt>
                    <dd>{{ .Format (i18n "dateFormat") }}</dd>
                </div>
                {{ end }}
                {{ with $end }}
                <div>
                    <dt>{{ i18n "End" }}</dt>
                    <dd>{{ .Format (i18n "dateFormat") }}</dd>
                </div>
                {{ end }}
                {{ with $.Scratch.Get "days" }}
                <div>
                    <dt>{{ i18n "Period" }}</dt>
                    <dd>{{ . }}{{ i18n "Days" }}</dd>
                </div>
                {{ end }}
                {{ with .Params.assignee }}
                <div>
                    <dt>{{ i18n "PIC" }}</dt>
                    <dd>{{ . }}</dd>
                </div>
                {{ end }}
                <div>
                    <dt>{{ i18n "LastUpdated" }}</dt>
                    <dd>
                        {{ with .Params.lastmod }}
                            {{ . | time.Format (i18n "dateFormat") }}
                        {{ else }}
                            {{ .Lastmod.Format (i18n "dateFormat") }}
                        {{ end }}
                    </dd>
                </div>
                {{ with .Params.tags }}
                <div class="project-tags">
                    <dt>{{ i18n "Tags" }}</dt>
                    <dd>
                        {{ range $index, $tag := . }}
                            {{ if $index }}, {{ end }}<span class="tag">{{ $tag }}</span>
                        {{ end }}
                    </dd>
                </div>
                {{ end }}
                {{ with .Params.parent }}
                {{ $parent := $.CurrentSection.GetPage . }}
                <div>
                    <dt>{{ i18n "ParentTask" }}</dt>
                    <dd>
                        {{ if $parent }}
                            <a href="{{ $parent.RelPermalink }}">{{ $parent.Title }}</a>
                        {{ else }}
                            {{ . }}
                        {{ end }}
                    </dd>
                </div>
                {{ end }}
            </dl>
            {{ $children := where $.CurrentSection.Pages "Params.parent" $.File.BaseFileName }}
            {{ if gt (len $children) 0 }}
            <div class="project-children">
                <h2>{{ i18n "ChildTasks" }}</h2>
                <ul>
                    {{ range $children }}
                    <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
                    {{ end }}
                </ul>
            </div>
            {{ end }}
        </section>

        <section class="project-body">
            {{ .Content }}
        </section>

        {{ with .Params.project_id }}
        <section class="project-dashboard">
            <h2>{{ i18n "ProjectDashboard" | default "Project Dashboard" }}</h2>
            <iframe
                src="{{ printf "%s?project_id=%s" ("dashboard/" | absLangURL) . }}"
                title="{{ i18n "ProjectDashboard" | default "Project Dashboard" }}"
                frameborder="0"
                width="100%"
                height="800"
                loading="lazy"
                allowfullscreen>
            </iframe>
        </section>
        {{ end }}

        {{ partial "backlink.html" . }}
    </article>
</div>

{{ partial "backlink-single.html" . }}
{{ partial "share-buttons.html" . }}

<style>
.project-single-container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 1.5rem;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.project-header {
    text-align: center;
    margin-bottom: 2rem;
}

.project-title {
    font-size: 2.8rem;
    color: #333;
    margin-bottom: 0.5rem;
    line-height: 1.2;
}

.project-description {
    font-size: 1.2rem;
    color: #666;
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.project-meta {
    display: flex;
    justify-content: center;
    gap: 1rem;
}

.project-details dl {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.project-details dt {
    font-weight: 600;
    color: #555;
}

.project-details dd {
    margin: 0.25rem 0 0;
    color: #333;
}

.project-tags span.tag {
    display: inline-block;
    background-color: #eef2ff;
    color: #4c51bf;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    margin-right: 0.5rem;
}

.project-children ul {
    list-style: disc;
    margin-left: 1.5rem;
}

.project-body {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #444;
    margin-bottom: 2rem;
}

.project-dashboard {
    margin-top: 3rem;
    border-top: 1px solid #eee;
    padding-top: 2rem;
}

.project-dashboard iframe {
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.project-footer {
    margin-top: 3rem;
    text-align: center;
}

@media (max-width: 768px) {
    .project-single-container {
        padding: 1rem;
        margin: 1rem auto;
    }

    .project-title {
        font-size: 2rem;
    }

    .project-details dl {
        grid-template-columns: 1fr;
    }

    .project-dashboard iframe {
        height: 600px;
    }
}
</style>
{{ end }}
