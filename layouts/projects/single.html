{{ define "main" }}
{{ $start := time .Params.start }}
{{ $end := time .Params.end }}
{{ $days := add 1 (div (sub ($end.Unix) ($start.Unix)) 86400) }}
<div class="card task-details" id="task-details">
  <div class="task-details-header">
    <h1 class="task-details-title">{{ .Title }}</h1>
    <div class="task-details-meta">
      <span class="status status-{{ if eq .Params.status "completed" }}completed{{ else if eq .Params.status "in-progress"
        }}in-progress{{ else }}not-started{{ end }}">
        {{ if eq .Params.status "completed" }}{{ i18n "taskCompleted" }}{{ else if eq .Params.status "in-progress" }}{{ i18n "taskInProgress" }}{{ else }}{{ i18n "taskNotStarted" }}{{ end }}
      </span>
      <span class="priority priority-{{ lower .Params.priority }}">
        {{ if eq .Params.priority "High" }}{{ i18n "priorityHigh" }}{{ else if eq .Params.priority "Medium" }}{{ i18n "priorityMedium" }}{{ else }}{{ i18n "priorityLow" }}{{ end }}
      </span>
    </div>
  </div>
  <div class="task-details-info">
    <div class="task-details-item">
      <div class="task-details-label">{{ i18n "Start" }}</div>
      <div class="task-details-value">{{ .Params.start }}</div>
    </div>
    <div class="task-details-item">
      <div class="task-details-label">{{ i18n "End" }}</div>
      <div class="task-details-value">{{ .Params.end }}</div>
    </div>
    <div class="task-details-item">
      <div class="task-details-label">{{ i18n "Period" }}</div>
      <div class="task-details-value">{{ $days }}{{ i18n "Days"}}</div>
    </div>
    <div class="task-details-item">
      <div class="task-details-label">{{ i18n "PIC" }}</div>
      <div class="task-details-value">{{ .Params.assignee }}</div>
    </div>
    <div class="task-details-item">
      <div class="task-details-label">{{ i18n "LastUpdated" }}</div>
      <div class="task-details-value">
        {{ with .Params.lastmod }}
          {{ . | time.Format "2006-01-02" }}
        {{ else }}
          {{ .Lastmod.Format "2006-01-02" }}
        {{ end }}
      </div>
    </div>
    {{ with .Params.tags }}
    <div class="task-details-item tags">
      <div class="task-details-label">{{ i18n "Tags" }}</div>
      <div class="task-details-value">
        {{ range $index, $tag := . }}
          {{ if $index }}, {{ end }}<span class="tag">{{ $tag }}</span>
        {{ end }}
      </div>
    </div>
    {{ end }}
    {{ with .Params.parent }}
    {{ $parent := $.CurrentSection.GetPage . }}
    <div class="task-details-item">
      <div class="task-details-label">{{ i18n "ParentTask" }}</div>
      <div class="task-details-value">
        {{ if $parent }}
          <a href="{{ $parent.RelPermalink }}">{{ $parent.Title }}</a>
        {{ else }}
          {{ . }}
        {{ end }}
      </div>
    </div>
    {{ end }}
    {{ $children := where $.CurrentSection.Pages "Params.parent" $.File.BaseFileName }}
    {{ if gt (len $children) 0 }}
    <div class="task-details-item">
      <div class="task-details-label">{{ i18n "ChildTasks" }}</div>
      <div class="task-details-value">
        <ul>
          {{ range $children }}
          <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
          {{ end }}
        </ul>
      </div>
    </div>
    {{ end }}
  </div>
  <div class="task-description">
    {{ .Content }}
  </div>
</div>
<div class="back-link">
  <a href="{{ .CurrentSection.RelPermalink }}">&larr; {{ i18n "Back"}}</a>
</div>
{{ if or .Params.socialShare (and .Site.Params.socialShare (ne .Params.socialShare false)) }}
<!-- Social Share Button HTML -->
<div class="share-box" aria-hidden="true">
    <ul class="share">
      <!-- Twitter -->
      <li>
        <a href="//twitter.com/share?url={{ .Permalink }}&amp;text={{ .Title }}&amp;via={{ .Site.Params.social.twitter }}" target="_blank" title="Share on Twitter">
          <img src="{{ "icons/twitter.svg" | relURL }}" alt="twitter icon" class="icon">
        </a>
      </li>

      <!-- Facebook -->
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u={{ .Permalink }}" target="_blank" title="Share on Facebook">
          <img src="{{ "icons/facebook.svg" | relURL }}" alt="facebook icon" class="icon">
        </a>
      </li>

      <!-- Threads -->
      <li>
        <a href="//www.threads.net/intent/post?text={{ .Title }}%20{{ .Permalink }}%20%23{{ .Site.Params.social.threads }}" target="_blank" title="Share on Threads">
          <img src="{{ "icons/threads.svg" | relURL }}" alt="threads icon" class="icon">
        </a>
      </li>

      <!-- LinkedIn -->
      <li>
        <a href="//www.linkedin.com/shareArticle?url={{ .Permalink }}&amp;title={{ .Title }}" target="_blank" title="Share on LinkedIn">
          <img src="{{ "icons/linkedin.svg" | relURL }}" alt="linkedin icon" class="icon">
        </a>
      </li>

      <!-- note -->
      <li>
        <a href="//note.com/intent/social_button" data-url="{{ .Permalink }}" target="_blank" title="Share on Note"></a>
          <img src="{{ "icons/note.svg" | relURL }}" alt="note icon" class="icon">
        </a>
      </li>

      <!-- bluesky -->
      <li>
        <a href="//bsky.app/intent/compose?text={{ .Title }}%20{{ .Permalink }}%20%23{{ .Site.Params.social.bluesky }}" target="_blank" title="Share on Bluesky"></a>
        <img src="{{ "icons/bluesky.svg" | relURL }}" alt="bluesky icon" class="icon">
        </a>
      </li>

      <!-- line -->
      <li>
        <a href="//line.me/R/share?text={{ .Title }}%20{{ .Permalink }}" target="_blank"
          title="Share on Line"></a>
        <img src="{{ "icons/line.svg" | relURL }}" alt="line icon" class="icon">
        </a>
      </li>

      <!-- Mastodon -->
      <li>
        <a href="//mstdn.jp/share?text={{ .Title }}%20{{ .Permalink }}" target="_blank" title="Share on Mastodon"></a>
        <img src="{{ "icons/mastodon.svg" | relURL }}" alt="mastodon icon" class="icon">
        </a>
      </li>

    </ul>
  </div>
  {{ end }}
{{ end }}
