{{ with .File }}
{{ $gid := printf "gantt-%s" (path.Base .Dir | urlize) }}
<div id="{{ $gid }}"></div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tasks = [
      {{- range $i, $t := $.Pages -}}
    {
      id: "{{ $t.File.BaseFileName }}",
      name: "{{ $t.Params.title }}",
      start: "{{ $t.Params.start }}",
      end: "{{ $t.Params.end }}",
      progress: {{ if eq $t.Params.status "completed" }}100{{ else if eq $t.Params.status "in-progress" }}50{{ else }}0{{ end }},
      custom_class: "status-{{ if eq $t.Params.status "completed" }}completed{{ else if eq $t.Params.status "in-progress" }}in-progress{{ else }}not-started{{ end }} priority-{{ lower $t.Params.priority }}"
        }{{ if lt (add $i 1) (len $.Pages) }}, {{ end }}
    {{- end }}
      ];
  new Gantt(document.getElementById('{{ $gid }}'), tasks, { view_mode: 'Day', date_format: 'YYYY-MM-DD' });
    });
</script>
{{ else }}
<div id="gantt-global"></div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tasks = [
      {{- $all := where (where $.Site.RegularPages "Section" "projects") "Params.start" "!=" nil -}}
      {{- range $i, $t := $all -}}
    {
      id: "{{ $t.File.BaseFileName }}",
      name: "{{ $t.Params.title }}",
      start: "{{ $t.Params.start }}",
      end: "{{ $t.Params.end }}",
      progress: {{ if eq $t.Params.status "completed" }}100{{ else if eq $t.Params.status "in-progress" }}50{{ else }}0{{ end }},
      custom_class: "status-{{ if eq $t.Params.status "completed" }}completed{{ else if eq $t.Params.status "in-progress" }}in-progress{{ else }}not-started{{ end }} priority-{{ lower $t.Params.priority }}"
        }{{ if lt (add $i 1) (len $all) }}, {{ end }}
      {{- end }}
    ];
  new Gantt(document.getElementById('gantt-global'), tasks, { view_mode: 'Day', date_format: 'YYYY-MM-DD' });
    });
</script>
{{ end }}
