<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "ja" }}">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        {{ partial "metadata.html" . }}
        <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>

	<!-- Favicon -->
        {{ if fileExists "static/img/favicon.ico" }}
        <link rel="icon" href="{{ "img/favicon.ico" | relURL }}">
        {{ else if fileExists "static/img/favicon.png" }}
        <link rel="icon" href="{{ "img/favicon.png" | relURL }}">
        {{ end }}

	<!-- Frappe Gantt -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">
        <!-- Frappe Gantt JS -->
        <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>

	<!-- Static CSS（static/ 配下にある場合） -->
        <link rel="stylesheet" href="{{ "css/styles.css" | relURL }}">
        <link rel="stylesheet" href="{{ "css/search.css" | relURL }}">
        {{ partial "gtm-head.html" . }}
</head>

<body>
        {{ partial "gtm-body.html" . }}
        {{ $current := . }}
        {{ $searchMenu := where .Site.Menus.main "Identifier" "search" }}
        {{ $translations := $.Site.Home.AllTranslations }}
        <header class="site-header header">
                <nav class="nav-container">
                        <button id="mobileMenuToggle" class="mobile-menu-btn" type="button" aria-expanded="false" aria-controls="mobileMenu" aria-label="{{ i18n "openMenu" }}">
                                <div class="hamburger" id="hamburgerIcon" aria-hidden="true">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                </div>
                        </button>

                        <a class="logo" href="{{ "" | absLangURL }}">{{ .Site.Title }}</a>

                        <ul class="nav-menu">
                                {{ range where .Site.Menus.main "Identifier" "!=" "search" }}
                                {{ $isActive := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
                                <li class="nav-item">
                                        <a class="nav-link{{ if $isActive }} active{{ end }}" href="{{ .URL | relURL }}">{{ .Name }}</a>
                                </li>
                                {{ end }}
                        </ul>

                        <div class="actions">
                                {{ if gt (len $searchMenu) 0 }}
                                {{ $search := index $searchMenu 0 }}
                                <button class="search-toggle" id="searchToggle" type="button" aria-expanded="false" aria-controls="searchPanel" aria-label="{{ $search.Name }}">🔍</button>
                                {{ end }}

                                <div class="search-panel" id="searchPanel">
                                        {{ if gt (len $searchMenu) 0 }}
                                        {{ $search := index $searchMenu 0 }}
                                        <div class="search-label">{{ $search.Name }}</div>
                                        <form role="search" method="get" action="{{ $search.URL | relURL }}">
                                                <input type="search" class="search-input" id="searchInput" name="q" placeholder="{{ i18n "SearchPlaceholder" | default (printf "%s..." $search.Name) }}">
                                        </form>
                                        {{ else }}
                                        <div class="search-label">{{ i18n "Search" | default "Search" }}</div>
                                        <input type="search" class="search-input" id="searchInput" placeholder="{{ i18n "SearchPlaceholder" | default "Search..." }}">
                                        {{ end }}
                                </div>

                                {{ if gt (len $translations) 1 }}
                                <div class="language-selector">
                                        <button class="language-btn" id="languageButton" type="button" aria-expanded="false" aria-controls="languageDropdown">🌐 <span id="currentLanguage">{{ .Site.Language.LanguageName }}</span></button>
                                        <div class="language-dropdown" id="languageDropdown">
                                                {{ range $translations }}
                                                {{ $trans := "" }}
                                                {{ $filtered := where $current.AllTranslations "Lang" .Lang }}
                                                {{ if gt (len $filtered) 0 }}{{ $trans = index $filtered 0 }}{{ end }}
                                                <button class="language-option{{ if eq .Lang $.Site.Language.Lang }} is-active{{ end }}" type="button" data-lang="{{ .Lang }}" data-url="{{ if $trans }}{{ $trans.RelPermalink }}{{ else }}{{ .RelPermalink }}{{ end }}">{{ .Language.LanguageName }}</button>
                                                {{ end }}
                                        </div>
                                </div>
                                {{ end }}

                                <span class="current-date" id="currentDate"></span>
                        </div>
                </nav>

                <div class="mobile-menu" id="mobileMenu">
                        <ul class="mobile-menu-list">
                                {{ range where .Site.Menus.main "Identifier" "!=" "search" }}
                                {{ $isActive := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
                                <li>
                                        <a class="mobile-menu-link{{ if $isActive }} active{{ end }}" href="{{ .URL | relURL }}">{{ .Name }}</a>
                                </li>
                                {{ end }}
                                {{ if gt (len $searchMenu) 0 }}
                                {{ $search := index $searchMenu 0 }}
                                <li>
                                        <a class="mobile-menu-link mobile-search-trigger" href="{{ $search.URL | relURL }}">🔍 {{ $search.Name }}</a>
                                </li>
                                {{ end }}
                        </ul>
                        {{ if gt (len $translations) 1 }}
                        <div class="mobile-divider"></div>
                        <button class="mobile-menu-link mobile-language-toggle" type="button">🌐 {{ i18n "SwitchLanguage" | default "Language" }}</button>
                        <div class="mobile-dropdown" id="languageDropdownMobile">
                                {{ range $translations }}
                                {{ $trans := "" }}
                                {{ $filtered := where $current.AllTranslations "Lang" .Lang }}
                                {{ if gt (len $filtered) 0 }}{{ $trans = index $filtered 0 }}{{ end }}
                                <button class="language-option{{ if eq .Lang $.Site.Language.Lang }} is-active{{ end }}" type="button" data-lang="{{ .Lang }}" data-url="{{ if $trans }}{{ $trans.RelPermalink }}{{ else }}{{ .RelPermalink }}{{ end }}">{{ .Language.LanguageName }}</button>
                                {{ end }}
                        </div>
                        {{ end }}
                </div>
        </header>

	<main class="site-main container">
		{{ block "main" . }}{{ end }}
	</main>

        {{- $lang := .Site.Language.Lang -}}
       <script src="{{ printf "js/today-%s.js" $lang | relURL }}" defer></script>
       <script src="{{ "js/menu-toggle.js" | relURL }}" defer></script>
       <button id="back-to-top" class="back-to-top" aria-label="{{ i18n "BackToTop" }}">&#x25B2;</button>
       <script src="{{ "js/back-to-top.js" | relURL }}" defer></script>

	<footer class="site-footer">
		<div class="container">
			<p>&copy; {{ .Site.Params.copyLight }}</p>
		</div>
	</footer>

</body>

</html>
